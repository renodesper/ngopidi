generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  extensions = [postgis]
}

model User {
  id             String    @id @default(uuid())
  name           String?
  email          String?   @unique
  email_verified DateTime?
  image          String?
  password       String?
  role           UserRole  @default(USER)
  accounts       Account[]
  sessions       Session[]
  created_at     DateTime @default(now()) @map("created_at")
  updated_at     DateTime @updatedAt      @map("updated_at")

  @@map("users")
}

model Account {
  id                  String @id @default(uuid()) @db.Uuid
  user_id             String @db.Uuid
  type                String
  provider            String
  provider_account_id String
  refresh_token       String?
  access_token        String?
  expires_at          Int?
  token_type          String?
  scope               String?
  id_token            String?
  session_state       String?
  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt      @map("updated_at")

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([provider, provider_account_id])
  @@map("accounts")
}


model Session {
  id            String   @id @default(uuid()) @db.Uuid
  session_token String   @unique
  user_id       String   @db.Uuid
  expires       DateTime
  created_at    DateTime @default(now()) @map("created_at")
  updated_at    DateTime @updatedAt      @map("updated_at")

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("sessions")
}


model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime
  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt      @map("updated_at")

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// ===========================
// ENUMS
// ===========================

enum WifiStability {
  poor
  average
  good
  excellent
}

enum WifiPolicy {
  free
  purchase_required
  time_limited
}

enum OutletDensity {
  few
  moderate
  many
}

enum SeatingType {
  single_table
  communal_table
  bar_seating
  sofa
}

enum TableSize {
  small
  medium
  large
}

enum NoiseLevel {
  quiet
  moderate
  noisy
}

enum MusicVolume {
  low
  medium
  loud
}

enum CrowdLevel {
  empty
  normal
  crowded
}

enum StayPolicy {
  no_limit
  soft_limit
  explicit_limit
}

enum TemperatureComfort {
  cold
  comfortable
  warm
}

enum SmokingArea {
  none
  separate
  indoor
}

enum CommonVisitor {
  students
  remote_workers
  meetings
  casual_visitors
}

enum PlaceStatus {
  PENDING
  SUBMITTED
  UNVERIFIED
  VERIFIED_ADMIN
  VERIFIED_USER
  REJECTED
}

model Place {
  id          String  @id @default(uuid())
  name        String
  description String?
  address     String

  // Spatial data
  latitude  Float
  longitude Float
  geo       Unsupported("geography(Point,4326)")?

  // Pricing
  price_level         Int? @map("price_level") // 1–5
  average_drink_price Int? @map("average_drink_price") // in local currency (e.g. IDR)
  minimum_spend       Int? @map("minimum_spend")

  // Connectivity
  wifi_available Boolean        @default(false) @map("wifi_available")
  wifi_speed     Int? @map("wifi_speed") // Mbps
  wifi_stability WifiStability? @map("wifi_stability")
  wifi_policy    WifiPolicy? @map("wifi_policy")

  // Power & seating
  power_outlets_available Boolean        @default(false) @map("power_outlets_available")
  power_outlet_density    OutletDensity? @map("power_outlet_density")
  table_size              TableSize? @map("table_size")
  seating_types           SeatingType[] @map("seating_types")

  // Environment
  noise_level  NoiseLevel? @map("noise_level")
  music_volume MusicVolume? @map("music_volume")
  crowd_level  CrowdLevel? @map("crowd_level")

  // Work suitability
  laptop_friendly     Boolean? @map("laptop_friendly")
  stay_policy         StayPolicy? @map("stay_policy")
  meeting_friendly    Boolean? @map("meeting_friendly")
  call_friendly       Boolean? @map("call_friendly")
  work_friendly_score Float? // 1.0 – 5.0

  // Facilities
  air_conditioning      Boolean? @map("air_conditioning")
  temperature_comfort   TemperatureComfort? @map("temperature_comfort")
  restroom_available    Boolean? @map("restroom_available")
  prayer_room_available Boolean            @default(false)
  smoking_area          SmokingArea? @map("smoking_area")
  parking_available     Boolean? @map("parking_available")

  // Meta
  opening_hours   String? @map("opening_hours") // keep flexible (JSON/string)
  busy_hours      String? @map("busy_hours") // e.g. JSON time ranges
  common_visitors CommonVisitor[] @map("common_visitors")

  status PlaceStatus @default(PENDING)

  images PlaceImage[]

  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt      @map("updated_at")

  @@index([status])
  @@index([laptop_friendly])
  @@index([latitude, longitude])
  @@index([wifi_available, power_outlets_available])
  @@index([noise_level, work_friendly_score])
  @@map("places")
}

model PlaceImage {
  id       String @id @default(uuid()) @db.Uuid
  url      String
  place_id String @db.Uuid

  place Place @relation(fields: [place_id], references: [id], onDelete: Cascade)

  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt      @map("updated_at")

  @@index([place_id])
  @@map("place_images")
}


enum UserRole {
  ADMIN
  USER
}
